<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Soneium S3 å¾½ç« ï¼ˆERCâ€‘721ï¼‰æ‰¹é‡æŸ¥è¯¢</title>
<meta name="color-scheme" content="light dark">
<style>
:root{
  --bg:#f4f5f7;--card:#fff;--txt:#202124;--sub:#70757a;
  --accent:#0078d4;--accent-dark:#005fa3;--ok:#16a34a;--bad:#dc2626}
@media(prefers-color-scheme:dark){
  :root{--bg:#1a1c1f;--card:#202225;--txt:#e8eaed;--sub:#9aa0a6}}
body{font-family:Arial,Helvetica,sans-serif;margin:0;background:var(--bg);color:var(--txt)}
.wrapper{max-width:860px;margin:32px auto;background:var(--card);padding:32px;border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.08)}
h2{text-align:center;color:var(--accent);margin:0 0 18px}
p.desc{margin:0 0 14px;color:var(--sub);font-size:14px;text-align:center}
textarea{width:100%;height:160px;font-size:15px;padding:10px;border-radius:8px;border:1px solid #ccc;background:var(--card);color:var(--txt)}
button{
  margin-top:14px;padding:11px 18px;font-size:15px;border:none;border-radius:8px;cursor:pointer;
  background:var(--accent);color:#fff;transition:.2s}
button:hover{background:var(--accent-dark)}
button.secondary{background:transparent;color:var(--accent);border:1px solid var(--accent)}
.actions{display:flex;gap:12px;flex-wrap:wrap}
.switch{display:flex;align-items:center;gap:6px;margin-top:14px;font-size:14px;color:var(--sub)}
.switch input{accent-color:var(--accent);cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:18px}
th,td{padding:8px 6px;text-align:center;border:1px solid #ddd}
th{background:var(--accent);color:#fff}
tbody tr:nth-child(odd){background:rgba(0,0,0,.03)}
.ok{color:var(--ok);font-weight:700}
.bad{color:var(--bad);font-weight:700}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12.5px}
#stats{margin-top:16px;font-size:15px;font-weight:700;text-align:left}
.small{font-size:12px;color:var(--sub);margin-top:6px}
footer{text-align:center;margin-top:26px;font-size:14px}
footer a{color:var(--accent);text-decoration:none;font-weight:700}
footer a:hover{text-decoration:underline}
.discord-link{
  display:inline-block;margin-top:12px;padding:10px 20px;border-radius:8px;
  background:#5865F2;color:#fff;font-weight:700;text-decoration:none}
.discord-link:hover{background:#4854c8}
.tag{display:inline-block;border:1px solid #cbd5e1;border-radius:999px;padding:2px 8px;font-size:12px;color:#334155;background:#f1f5f9}
@media(prefers-color-scheme:dark){.tag{border-color:#424b57;color:#9aa0a6;background:#111318}}
</style>
</head>
<body>
<div class="wrapper">
  <h2>Soneium S3 å¾½ç« æ‰¹é‡æŸ¥è¯¢ï¼ˆERCâ€‘721ï¼‰</h2>
  <p class="desc">
    <span class="mono"></span>
    <a class="tag" href="https://soneium.blockscout.com/address/0x05AB5e724848cEFeac6D303CDf94032E5Cc3552B" target="_blank" rel="noopener">æŸ¥çœ‹åˆçº¦</a>
  </p>

  <p>è¾“å…¥é’±åŒ…åœ°å€ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ï¼š</p>
  <textarea id="walletInput" placeholder="0x....&#10;0x....&#10;0x...."></textarea>

  <div class="actions">
    <button id="queryBtn">æŸ¥è¯¢</button>
    <button id="exportBtn" style="display:none">å¯¼å‡º CSV</button>
    <button id="clearBtn" class="secondary">æ¸…ç©º</button>
  </div>

  <label class="switch"><input type="checkbox" id="showOGOnly">åªæ˜¾ç¤ºæ‹¥æœ‰ S3 å¾½ç« </label>
  <div class="small">è¯´æ˜ï¼šè°ƒç”¨ Blockscout API <span class="mono">/api/v2/addresses/&lt;owner&gt;/tokens?type=ERC-721</span>ï¼Œå¦‚æœ‰ç¿»é¡µå°†è‡ªåŠ¨è·Ÿè¿›ï¼›å‘½ä¸­åå³åœæ­¢è¯¥åœ°å€çš„åç»­è¯·æ±‚ã€‚</div>

  <div id="stats"></div>

  <table id="resTable">
    <thead><tr><th>ç¼–å·</th><th>é’±åŒ…åœ°å€</th><th>S3 å¾½ç« </th></tr></thead>
    <tbody></tbody>
  </table>

  <a class="discord-link" href="https://discord.com/invite/soneium" target="_blank">ğŸ“¢ åŠ å…¥ Soneium Discord</a>

  <footer>
    ğŸ¦ ä½œè€…æ¨ç‰¹ï¼š<a href="https://x.com/0xXIAOc" target="_blank">@0xXIAOc</a>
  </footer>
</div>

<script>
/* -------- é…ç½® -------- */
const API_BASE = "https://soneium.blockscout.com/api/v2/addresses/";
const TARGET_CONTRACT = "0x7bf02b42b9d4ccd85b497c9f53e6b7474f9c2546".toLowerCase(); // Soneium Score Season 3 Badgeï¼ˆERCâ€‘721ï¼‰
const MAX_PAGES = 25;        // å•åœ°å€æœ€å¤šç¿»é¡µæ¬¡æ•°ä¿æŠ¤
const CONCURRENCY = 4;       // å¹¶å‘å·¥ä½œåç¨‹æ•°é‡ï¼ˆæ ¹æ®éœ€è¦å¯è°ƒå°é¿å…é¢‘ç‡é™åˆ¶ï¼‰

/* -------- DOM -------- */
const $ = id => document.getElementById(id);
const tableBody = document.querySelector("#resTable tbody");
const statsDiv = $("stats");
const exportBtn = $("exportBtn");
const filterCheck = $("showOGOnly");
const input = $("walletInput");

/* -------- å·¥å…· -------- */
const sleep = ms => new Promise(r => setTimeout(r, ms));
const normAddr = a => (a || "").trim();
const isHexAddr = a => /^0x[a-fA-F0-9]{40}$/.test(a);
const toCSV = rows => rows.map(r => r.map(v => `"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");
function download(text, filename){
  const blob = new Blob([text], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = filename; document.body.appendChild(a); a.click();
  setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
}
function updateFilter(){
  const hide = filterCheck.checked;
  [...tableBody.children].forEach(tr => {
    const has = tr.dataset.og === "yes";
    tr.style.display = hide && !has ? "none" : "";
  });
}
function serializeQuery(obj){
  if(!obj || typeof obj !== "object") return "";
  const params = new URLSearchParams();
  for(const [k,v] of Object.entries(obj)){
    if(v !== undefined && v !== null && v !== "") params.append(k, v);
  }
  const q = params.toString();
  return q ? "&" + q : "";
}

/* -------- ä¸šåŠ¡ï¼šåˆ¤æ–­æ˜¯å¦æŒæœ‰ç›®æ ‡ ERC-721 åˆçº¦ -------- */
async function hasTargetErc721(owner){
  let url = `${API_BASE}${owner}/tokens?type=ERC-721`;
  for(let page=0; page<MAX_PAGES; page++){
    const res = await fetch(url, { method: "GET" });
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    const items = Array.isArray(data.items) ? data.items : [];

    for(const it of items){
      const t = it && it.token;
      const addrHash = t && t.address_hash && String(t.address_hash).toLowerCase();
      if(addrHash === TARGET_CONTRACT){
        const val = parseInt(it.value ?? "0", 10);
        if(val > 0){
          return { ok:true, value:val, name: t.name || "", symbol: t.symbol || "" };
        }
      }
    }
    const next = data.next_page_params;
    if(!next) return { ok:false };
    url = `${API_BASE}${owner}/tokens?type=ERC-721${serializeQuery(next)}`;
    await sleep(120); // è½»å¾®èŠ‚æµï¼Œå‹å¥½ç¿»é¡µ
  }
  return { ok:false, note:"max_pages_exceeded" };
}

/* -------- æ‰¹é‡å¤„ç†ï¼ˆå¹¶å‘ worker æ± ï¼‰ -------- */
async function runBatch(addresses){
  // åˆå§‹åŒ–è¡¨æ ¼
  tableBody.innerHTML = "";
  statsDiv.textContent = "æŸ¥è¯¢ä¸­â€¦";
  exportBtn.style.display = "none";

  const rowsRef = [];
  const csv = [["index","address","s1_badge"]];

  // å…ˆæ¸²æŸ“ç©ºè¡Œ
  addresses.forEach((addr, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${i+1}</td>
                    <td class="mono"><a href="https://soneium.blockscout.com/address/${addr}" target="_blank" rel="noopener">${addr}</a></td>
                    <td>æŸ¥è¯¢ä¸­â€¦</td>`;
    tr.dataset.og = "no";
    tableBody.appendChild(tr);
    rowsRef[i] = { tr, cell: tr.children[2] };
  });

  let ogCount = 0;
  let done = 0;
  let idx = 0;

  async function worker(){
    while(true){
      const my = idx++;
      if(my >= addresses.length) break;
      const addr = addresses[my];
      const { tr, cell } = rowsRef[my];
      try{
        const r = await hasTargetErc721(addr);
        if(r.ok){
          cell.innerHTML = '<span class="ok">âœ… æœ‰</span>';
          tr.dataset.og = "yes";
          ogCount++;
          csv.push([my+1, addr, "yes"]);
        }else{
          cell.innerHTML = '<span class="bad">âŒ æ— </span>';
          tr.dataset.og = "no";
          csv.push([my+1, addr, "no"]);
        }
      }catch(e){
        console.error("æŸ¥è¯¢å¤±è´¥:", addr, e);
        cell.innerHTML = `<span class="bad">âš ï¸ å¤±è´¥</span>`;
        tr.dataset.og = "no";
        csv.push([my+1, addr, "error"]);
      }finally{
        done++;
        statsDiv.textContent = `å·²å®Œæˆ ${done}/${addresses.length} Â· å‘½ä¸­ ${ogCount}`;
      }
      // è½»å¾®æŠ–åŠ¨èŠ‚æµï¼Œé™ä½è¢«é™é¢‘æ¦‚ç‡
      await sleep(80 + Math.random()*120);
    }
  }

  // å¯åŠ¨å¹¶å‘ worker
  const workers = Array.from({length: Math.min(CONCURRENCY, addresses.length)}, () => worker());
  await Promise.all(workers);

  statsDiv.textContent = `å…± ${addresses.length} ä¸ªåœ°å€ï¼Œå…¶ä¸­æ‹¥æœ‰ S3 å¾½ç« çš„æœ‰ ${ogCount} ä¸ª`;

  exportBtn.style.display = "inline-block";
  exportBtn.onclick = () => download(toCSV(csv), "s1_badge_results.csv");
  updateFilter();
}

/* -------- äº¤äº’ -------- */
$("queryBtn").onclick = async () => {
  const raw = input.value.trim();
  if(!raw){ alert("è¯·å…ˆè¾“å…¥é’±åŒ…åœ°å€ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰"); return; }

  // è§£æ & å»é‡ & æ ¡éªŒ
  const parts = raw.split(/\r?\n|,|;|\s+/).map(normAddr).filter(Boolean);
  const uniq = [...new Set(parts)];
  const valid = uniq.filter(isHexAddr);
  const invalid = uniq.filter(a => !isHexAddr(a));

  if(!valid.length){ alert("æ²¡æœ‰æœ‰æ•ˆçš„é’±åŒ…åœ°å€ï¼ˆ0x å¼€å¤´ï¼Œ40 ä½åå…­è¿›åˆ¶ï¼‰"); return; }

  if(invalid.length){
    if(!confirm(`å‘ç° ${invalid.length} æ¡æ— æ•ˆåœ°å€å°†è¢«å¿½ç•¥ã€‚\næ˜¯å¦ç»§ç»­ï¼Ÿ`)) return;
  }

  await runBatch(valid);
};

$("clearBtn").onclick = () => {
  input.value = "";
  tableBody.innerHTML = "";
  statsDiv.textContent = "";
  exportBtn.style.display = "none";
};

filterCheck.onchange = updateFilter;
</script>
</body>
</html>





